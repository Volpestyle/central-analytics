---
import Layout from '../layouts/Layout.astro';
import { AuthApp } from '@components/AuthApp';
import '../styles/global.css';
---

<Layout title="Central Analytics - Sign In">
  <AuthApp client:only="react" />
</Layout>

<script>

  // Register service worker for PWA
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js').catch((error) => {
        console.error('Service Worker registration failed:', error);
      });
    });
  }

  // Handle PWA install prompt
  interface BeforeInstallPromptEvent extends Event {
    prompt: () => Promise<void>;
    userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;
  }

  let deferredPrompt: BeforeInstallPromptEvent | null = null;

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e as BeforeInstallPromptEvent;
    // Store for use in BiometricLogin component
    (window as any).deferredPrompt = deferredPrompt;
  });
</script>